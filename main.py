# -*- coding: utf-8 -*-
from utils.datapreprocess import *
from utils.lgb_model import lgb_model
import gc

if __name__ == '__main__':
    features = ['fans_num','vip_num','main_cate','shop_score','age','sex','user_lv_cd','city_level','province','city','county','shop_reg_year','shop_reg_days','same_with_main_cate','user_reg_year','user_reg_days','shop_own_skus','shop_own_brands','shop_own_cates','shop_comment_nums','shop_good_comment_nums','shop_bad_comment_nums','shop_good_comm_rate_mean','shop_good_comm_rate_max','shop_good_comm_rate_min','shop_bad_comm_rate_mean','shop_bad_comm_rate_max','shop_bad_comm_rate_min','cate_own_skus','cate_own_brands','cate_own_shops','cate_comment_nums','cate_good_comment_nums','cate_bad_comment_nums','cate_good_comm_rate_mean','cate_good_comm_rate_max','cate_good_comm_rate_min','cate_bad_comm_rate_mean','cate_bad_comm_rate_max','cate_bad_comm_rate_min','shop_cate_own_skus','shop_cate_own_brands','shop_cate_comment_nums','shop_cate_good_comment_nums','shop_cate_bad_comment_nums','shop_cate_good_comm_rate_mean','shop_cate_good_comm_rate_max','shop_cate_good_comm_rate_min','shop_cate_bad_comm_rate_mean','shop_cate_bad_comm_rate_max','shop_cate_bad_comm_rate_min','cate_2_coversion_rate','cate_3_coversion_rate','cate_4_coversion_rate','user_id_2_coversion_rate','user_id_3_coversion_rate','user_id_4_coversion_rate','shop_id_2_coversion_rate','shop_id_3_coversion_rate','shop_id_4_coversion_rate','province_2_coversion_rate','province_3_coversion_rate','province_4_coversion_rate','city_2_coversion_rate','city_3_coversion_rate','city_4_coversion_rate','county_2_coversion_rate','county_3_coversion_rate','county_4_coversion_rate','age_2_coversion_rate','age_3_coversion_rate','age_4_coversion_rate','sex_2_coversion_rate','sex_3_coversion_rate','sex_4_coversion_rate','user_id_cate_2_coversion_rate','user_id_cate_3_coversion_rate','user_id_cate_4_coversion_rate','user_id_shop_id_2_coversion_rate','user_id_shop_id_3_coversion_rate','user_id_shop_id_4_coversion_rate','cate_shop_id_2_coversion_rate','cate_shop_id_3_coversion_rate','cate_shop_id_4_coversion_rate','age_shop_id_2_coversion_rate','age_shop_id_3_coversion_rate','age_shop_id_4_coversion_rate','age_cate_2_coversion_rate','age_cate_3_coversion_rate','age_cate_4_coversion_rate','age_province_2_coversion_rate','age_province_3_coversion_rate','age_province_4_coversion_rate','age_city_2_coversion_rate','age_city_3_coversion_rate','age_city_4_coversion_rate','age_county_2_coversion_rate','age_county_3_coversion_rate','age_county_4_coversion_rate','sex_shop_id_2_coversion_rate','sex_shop_id_3_coversion_rate','sex_shop_id_4_coversion_rate','sex_cate_2_coversion_rate','sex_cate_3_coversion_rate','sex_cate_4_coversion_rate','sex_province_2_coversion_rate','sex_province_3_coversion_rate','sex_province_4_coversion_rate','sex_city_2_coversion_rate','sex_city_3_coversion_rate','sex_city_4_coversion_rate','sex_county_2_coversion_rate','sex_county_3_coversion_rate','sex_county_4_coversion_rate','shop_action1_counts_1day','shop_action2_counts_1day','shop_action3_counts_1day','shop_action4_counts_1day','shop_action5_counts_1day','user_action1_counts_1day','user_action2_counts_1day','user_action3_counts_1day','user_action4_counts_1day','user_action5_counts_1day','user_action2_counts_date_1day','user_action3_counts_date_1day','user_action4_counts_date_1day','cate_action1_counts_1day','cate_action2_counts_1day','cate_action3_counts_1day','cate_action4_counts_1day','cate_action5_counts_1day','province_action1_counts_1day','province_action2_counts_1day','province_action3_counts_1day','province_action4_counts_1day','province_action5_counts_1day','city_action1_counts_1day','city_action2_counts_1day','city_action3_counts_1day','city_action4_counts_1day','city_action5_counts_1day','county_action1_counts_1day','county_action2_counts_1day','county_action3_counts_1day','county_action4_counts_1day','county_action5_counts_1day','age_action1_counts_1day','age_action2_counts_1day','age_action3_counts_1day','age_action4_counts_1day','age_action5_counts_1day','sex_action1_counts_1day','sex_action2_counts_1day','sex_action3_counts_1day','sex_action4_counts_1day','sex_action5_counts_1day','user_cate_action1_counts_1day','user_cate_action2_counts_1day','user_cate_action3_counts_1day','user_cate_action4_counts_1day','user_cate_action5_counts_1day','user_shop_action1_counts_1day','user_shop_action2_counts_1day','user_shop_action3_counts_1day','user_shop_action4_counts_1day','user_shop_action5_counts_1day','sex_cate_action1_counts_1day','sex_cate_action2_counts_1day','sex_cate_action3_counts_1day','sex_cate_action4_counts_1day','sex_cate_action5_counts_1day','sex_shop_action1_counts_1day','sex_shop_action2_counts_1day','sex_shop_action3_counts_1day','sex_shop_action4_counts_1day','sex_shop_action5_counts_1day','age_cate_action1_counts_1day','age_cate_action2_counts_1day','age_cate_action3_counts_1day','age_cate_action4_counts_1day','age_cate_action5_counts_1day','age_shop_action1_counts_1day','age_shop_action2_counts_1day','age_shop_action3_counts_1day','age_shop_action4_counts_1day','age_shop_action5_counts_1day','shop_action1_counts_3day','shop_action2_counts_3day','shop_action3_counts_3day','shop_action4_counts_3day','shop_action5_counts_3day','user_action1_counts_3day','user_action2_counts_3day','user_action3_counts_3day','user_action4_counts_3day','user_action5_counts_3day','user_action2_counts_date_3day','user_action3_counts_date_3day','user_action4_counts_date_3day','cate_action1_counts_3day','cate_action2_counts_3day','cate_action3_counts_3day','cate_action4_counts_3day','cate_action5_counts_3day','province_action1_counts_3day','province_action2_counts_3day','province_action3_counts_3day','province_action4_counts_3day','province_action5_counts_3day','city_action1_counts_3day','city_action2_counts_3day','city_action3_counts_3day','city_action4_counts_3day','city_action5_counts_3day','county_action1_counts_3day','county_action2_counts_3day','county_action3_counts_3day','county_action4_counts_3day','county_action5_counts_3day','age_action1_counts_3day','age_action2_counts_3day','age_action3_counts_3day','age_action4_counts_3day','age_action5_counts_3day','sex_action1_counts_3day','sex_action2_counts_3day','sex_action3_counts_3day','sex_action4_counts_3day','sex_action5_counts_3day','user_cate_action1_counts_3day','user_cate_action2_counts_3day','user_cate_action3_counts_3day','user_cate_action4_counts_3day','user_cate_action5_counts_3day','user_shop_action1_counts_3day','user_shop_action2_counts_3day','user_shop_action3_counts_3day','user_shop_action4_counts_3day','user_shop_action5_counts_3day','sex_cate_action1_counts_3day','sex_cate_action2_counts_3day','sex_cate_action3_counts_3day','sex_cate_action4_counts_3day','sex_cate_action5_counts_3day','sex_shop_action1_counts_3day','sex_shop_action2_counts_3day','sex_shop_action3_counts_3day','sex_shop_action4_counts_3day','sex_shop_action5_counts_3day','age_cate_action1_counts_3day','age_cate_action2_counts_3day','age_cate_action3_counts_3day','age_cate_action4_counts_3day','age_cate_action5_counts_3day','age_shop_action1_counts_3day','age_shop_action2_counts_3day','age_shop_action3_counts_3day','age_shop_action4_counts_3day','age_shop_action5_counts_3day','shop_action1_counts_7day','shop_action2_counts_7day','shop_action3_counts_7day','shop_action4_counts_7day','shop_action5_counts_7day','user_action1_counts_7day','user_action2_counts_7day','user_action3_counts_7day','user_action4_counts_7day','user_action5_counts_7day','user_action2_counts_date_7day','user_action3_counts_date_7day','user_action4_counts_date_7day','cate_action1_counts_7day','cate_action2_counts_7day','cate_action3_counts_7day','cate_action4_counts_7day','cate_action5_counts_7day','province_action1_counts_7day','province_action2_counts_7day','province_action3_counts_7day','province_action4_counts_7day','province_action5_counts_7day','city_action1_counts_7day','city_action2_counts_7day','city_action3_counts_7day','city_action4_counts_7day','city_action5_counts_7day','county_action1_counts_7day','county_action2_counts_7day','county_action3_counts_7day','county_action4_counts_7day','county_action5_counts_7day','age_action1_counts_7day','age_action2_counts_7day','age_action3_counts_7day','age_action4_counts_7day','age_action5_counts_7day','sex_action1_counts_7day','sex_action2_counts_7day','sex_action3_counts_7day','sex_action4_counts_7day','sex_action5_counts_7day','user_cate_action1_counts_7day','user_cate_action2_counts_7day','user_cate_action3_counts_7day','user_cate_action4_counts_7day','user_cate_action5_counts_7day','user_shop_action1_counts_7day','user_shop_action2_counts_7day','user_shop_action3_counts_7day','user_shop_action4_counts_7day','user_shop_action5_counts_7day','sex_cate_action1_counts_7day','sex_cate_action2_counts_7day','sex_cate_action3_counts_7day','sex_cate_action4_counts_7day','sex_cate_action5_counts_7day','sex_shop_action1_counts_7day','sex_shop_action2_counts_7day','sex_shop_action3_counts_7day','sex_shop_action4_counts_7day','sex_shop_action5_counts_7day','age_cate_action1_counts_7day','age_cate_action2_counts_7day','age_cate_action3_counts_7day','age_cate_action4_counts_7day','age_cate_action5_counts_7day','age_shop_action1_counts_7day','age_shop_action2_counts_7day','age_shop_action3_counts_7day','age_shop_action4_counts_7day','age_shop_action5_counts_7day','shop_action1_counts_21day','shop_action2_counts_21day','shop_action3_counts_21day','shop_action4_counts_21day','shop_action5_counts_21day','user_action1_counts_21day','user_action2_counts_21day','user_action3_counts_21day','user_action4_counts_21day','user_action5_counts_21day','user_action2_counts_date_21day','user_action3_counts_date_21day','user_action4_counts_date_21day','cate_action1_counts_21day','cate_action2_counts_21day','cate_action3_counts_21day','cate_action4_counts_21day','cate_action5_counts_21day','province_action1_counts_21day','province_action2_counts_21day','province_action3_counts_21day','province_action4_counts_21day','province_action5_counts_21day','city_action1_counts_21day','city_action2_counts_21day','city_action3_counts_21day','city_action4_counts_21day','city_action5_counts_21day','county_action1_counts_21day','county_action2_counts_21day','county_action3_counts_21day','county_action4_counts_21day','county_action5_counts_21day','age_action1_counts_21day','age_action2_counts_21day','age_action3_counts_21day','age_action4_counts_21day','age_action5_counts_21day','sex_action1_counts_21day','sex_action2_counts_21day','sex_action3_counts_21day','sex_action4_counts_21day','sex_action5_counts_21day','user_cate_action1_counts_21day','user_cate_action2_counts_21day','user_cate_action3_counts_21day','user_cate_action4_counts_21day','user_cate_action5_counts_21day','user_shop_action1_counts_21day','user_shop_action2_counts_21day','user_shop_action3_counts_21day','user_shop_action4_counts_21day','user_shop_action5_counts_21day','sex_cate_action1_counts_21day','sex_cate_action2_counts_21day','sex_cate_action3_counts_21day','sex_cate_action4_counts_21day','sex_cate_action5_counts_21day','sex_shop_action1_counts_21day','sex_shop_action2_counts_21day','sex_shop_action3_counts_21day','sex_shop_action4_counts_21day','sex_shop_action5_counts_21day','age_cate_action1_counts_21day','age_cate_action2_counts_21day','age_cate_action3_counts_21day','age_cate_action4_counts_21day','age_cate_action5_counts_21day','age_shop_action1_counts_21day','age_shop_action2_counts_21day','age_shop_action3_counts_21day','age_shop_action4_counts_21day','age_shop_action5_counts_21day','user_action_cates_1day','user_action1_cates_1day','user_action2_cates_1day','user_action3_cates_1day','user_action4_cates_1day','user_action_modules_1day','user_action1_modules_1day','user_action2_modules_1day','user_action3_modules_1day','user_action4_modules_1day','user_action_shops_1day','user_action1_shops_1day','user_action2_shops_1day','user_action3_shops_1day','user_action4_shops_1day','user_action_skus_1day','user_action1_skus_1day','user_action2_skus_1day','user_action3_skus_1day','user_action4_skus_1day','shop_action1_skus_1day','shop_action2_skus_1day','shop_action3_skus_1day','shop_action4_skus_1day','shop_action_skus_1day','shop_action1_brands_1day','shop_action2_brands_1day','shop_action3_brands_1day','shop_action4_brands_1day','shop_action_brands_1day','cate_action1_shops_1day','cate_action2_shops_1day','cate_action3_shops_1day','cate_action4_shops_1day','cate_action_shops_1day','cate_action1_skus_1day','cate_action2_skus_1day','cate_action3_skus_1day','cate_action4_skus_1day','cate_action_skus_1day','cate_action1_brands_1day','cate_action2_brands_1day','cate_action3_brands_1day','cate_action4_brands_1day','cate_action_brands_1day','user_cate_action1_shops_1day','user_cate_action2_shops_1day','user_cate_action3_shops_1day','user_cate_action4_shops_1day','user_cate_action_shops_1day','user_cate_action1_skus_1day','user_cate_action2_skus_1day','user_cate_action3_skus_1day','user_cate_action4_skus_1day','user_cate_action_skus_1day','user_cate_action1_brands_1day','user_cate_action2_brands_1day','user_cate_action3_brands_1day','user_cate_action4_brands_1day','user_cate_action_brands_1day','user_action_cates_3day','user_action1_cates_3day','user_action2_cates_3day','user_action3_cates_3day','user_action4_cates_3day','user_action_modules_3day','user_action1_modules_3day','user_action2_modules_3day','user_action3_modules_3day','user_action4_modules_3day','user_action_shops_3day','user_action1_shops_3day','user_action2_shops_3day','user_action3_shops_3day','user_action4_shops_3day','user_action_skus_3day','user_action1_skus_3day','user_action2_skus_3day','user_action3_skus_3day','user_action4_skus_3day','shop_action1_skus_3day','shop_action2_skus_3day','shop_action3_skus_3day','shop_action4_skus_3day','shop_action_skus_3day','shop_action1_brands_3day','shop_action2_brands_3day','shop_action3_brands_3day','shop_action4_brands_3day','shop_action_brands_3day','cate_action1_shops_3day','cate_action2_shops_3day','cate_action3_shops_3day','cate_action4_shops_3day','cate_action_shops_3day','cate_action1_skus_3day','cate_action2_skus_3day','cate_action3_skus_3day','cate_action4_skus_3day','cate_action_skus_3day','cate_action1_brands_3day','cate_action2_brands_3day','cate_action3_brands_3day','cate_action4_brands_3day','cate_action_brands_3day','user_cate_action1_shops_3day','user_cate_action2_shops_3day','user_cate_action3_shops_3day','user_cate_action4_shops_3day','user_cate_action_shops_3day','user_cate_action1_skus_3day','user_cate_action2_skus_3day','user_cate_action3_skus_3day','user_cate_action4_skus_3day','user_cate_action_skus_3day','user_cate_action1_brands_3day','user_cate_action2_brands_3day','user_cate_action3_brands_3day','user_cate_action4_brands_3day','user_cate_action_brands_3day','user_action_cates_7day','user_action1_cates_7day','user_action2_cates_7day','user_action3_cates_7day','user_action4_cates_7day','user_action_modules_7day','user_action1_modules_7day','user_action2_modules_7day','user_action3_modules_7day','user_action4_modules_7day','user_action_shops_7day','user_action1_shops_7day','user_action2_shops_7day','user_action3_shops_7day','user_action4_shops_7day','user_action_skus_7day','user_action1_skus_7day','user_action2_skus_7day','user_action3_skus_7day','user_action4_skus_7day','shop_action1_skus_7day','shop_action2_skus_7day','shop_action3_skus_7day','shop_action4_skus_7day','shop_action_skus_7day','shop_action1_brands_7day','shop_action2_brands_7day','shop_action3_brands_7day','shop_action4_brands_7day','shop_action_brands_7day','cate_action1_shops_7day','cate_action2_shops_7day','cate_action3_shops_7day','cate_action4_shops_7day','cate_action_shops_7day','cate_action1_skus_7day','cate_action2_skus_7day','cate_action3_skus_7day','cate_action4_skus_7day','cate_action_skus_7day','cate_action1_brands_7day','cate_action2_brands_7day','cate_action3_brands_7day','cate_action4_brands_7day','cate_action_brands_7day','user_cate_action1_shops_7day','user_cate_action2_shops_7day','user_cate_action3_shops_7day','user_cate_action4_shops_7day','user_cate_action_shops_7day','user_cate_action1_skus_7day','user_cate_action2_skus_7day','user_cate_action3_skus_7day','user_cate_action4_skus_7day','user_cate_action_skus_7day','user_cate_action1_brands_7day','user_cate_action2_brands_7day','user_cate_action3_brands_7day','user_cate_action4_brands_7day','user_cate_action_brands_7day','user_action_cates_21day','user_action1_cates_21day','user_action2_cates_21day','user_action3_cates_21day','user_action4_cates_21day','user_action_modules_21day','user_action1_modules_21day','user_action2_modules_21day','user_action3_modules_21day','user_action4_modules_21day','user_action_shops_21day','user_action1_shops_21day','user_action2_shops_21day','user_action3_shops_21day','user_action4_shops_21day','user_action_skus_21day','user_action1_skus_21day','user_action2_skus_21day','user_action3_skus_21day','user_action4_skus_21day','shop_action1_skus_21day','shop_action2_skus_21day','shop_action3_skus_21day','shop_action4_skus_21day','shop_action_skus_21day','shop_action1_brands_21day','shop_action2_brands_21day','shop_action3_brands_21day','shop_action4_brands_21day','shop_action_brands_21day','cate_action1_shops_21day','cate_action2_shops_21day','cate_action3_shops_21day','cate_action4_shops_21day','cate_action_shops_21day','cate_action1_skus_21day','cate_action2_skus_21day','cate_action3_skus_21day','cate_action4_skus_21day','cate_action_skus_21day','cate_action1_brands_21day','cate_action2_brands_21day','cate_action3_brands_21day','cate_action4_brands_21day','cate_action_brands_21day','user_cate_action1_shops_21day','user_cate_action2_shops_21day','user_cate_action3_shops_21day','user_cate_action4_shops_21day','user_cate_action_shops_21day','user_cate_action1_skus_21day','user_cate_action2_skus_21day','user_cate_action3_skus_21day','user_cate_action4_skus_21day','user_cate_action_skus_21day','user_cate_action1_brands_21day','user_cate_action2_brands_21day','user_cate_action3_brands_21day','user_cate_action4_brands_21day','user_cate_action_brands_21day','user_action_times','user_action1_times','user_action2_times','user_action3_times','user_action4_times','shop_action_times','shop_action1_times','shop_action2_times','shop_action3_times','shop_action4_times','cate_action_times','cate_action1_times','cate_action2_times','cate_action3_times','cate_action4_times','user_cate_action_times','user_cate_action1_times','user_cate_action2_times','user_cate_action3_times','user_cate_action4_times','shop_cate_action_times','shop_cate_action1_times','shop_cate_action2_times','shop_cate_action3_times','shop_cate_action4_times','user_shop_action_times','user_shop_action1_times','user_shop_action2_times','user_shop_action3_times','user_shop_action4_times','user_cate_shop_action_times','user_cate_shop_action1_times','user_cate_shop_action2_times','user_cate_shop_action3_times','user_cate_shop_action4_times','user_like_cate1_rank','user_like_cate3_rank','user_like_cate7_rank','user_like_cate21_rank','ruser_like_cate1_rank','ruser_like_cate3_rank','ruser_like_cate7_rank','ruser_like_cate21_rank','user_like_shop1_rank','user_like_shop3_rank','user_like_shop7_rank','user_like_shop21_rank','ruser_like_shop1_rank','ruser_like_shop3_rank','ruser_like_shop7_rank','ruser_like_shop21_rank','sex_like_cate1_rank','sex_like_cate3_rank','sex_like_cate7_rank','sex_like_cate21_rank','sex_like_shop1_rank','sex_like_shop3_rank','sex_like_shop7_rank','sex_like_shop21_rank','age_like_cate1_rank','age_like_cate3_rank','age_like_cate7_rank','age_like_cate21_rank','age_like_shop1_rank','age_like_shop3_rank','age_like_shop7_rank','age_like_shop21_rank']

    jdata_process_class = jdata_process()

    sample = jdata_process_class.gen_samples()
    print('Step1. 生成样本sample完成 '+str(sample.shape))
    sample = jdata_process_class.add_static_fea(sample)
    print('Step2.1 加入静态特征完成 ' + str(sample.shape))
    sample = jdata_process_class.add_comment_fea(sample)
    print(str(sample.shape))
    sample = jdata_process_class.add_conversion1_fea(sample)
    print(str(sample.shape))
    sample = jdata_process_class.add_conversion2_fea(sample)
    print(str(sample.shape))
    sample = jdata_process_class.add_user_behavier_fea(sample)
    print(str(sample.shape))
    sample = jdata_process_class.add_user_behavier2_fea(sample)
    print(str(sample.shape))
    sample = jdata_process_class.add_static_action_fea(sample)
    print(str(sample.shape))

    sample = jdata_process_class.gen_rank_fea(sample)

    # sample = pd.read_csv("./dataset/sample_tmp.csv")

    class1,class2,class3 = jdata_process_class.get_classes()
    print("用户分群完成")
    sample_v01 = sample[sample.user_id.isin(class2)]
    print(len(sample_v01))

    # 线下预测 结果
    print('baseline1 start')
    test_v01_online1 = sample_v01[sample_v01.action_date == '2018-04-15']
    test_v01_online2 = sample_v01[sample_v01.action_date == '2018-04-14']

    model = lgb_model()
    model.train(sample = sample_v01[sample_v01.action_date < '2018-04-13'], features=features)
    test_v01_online1 = model.predict(test_v01_online1,features)
    test_v01_online2 = model.predict(test_v01_online2,features)
    result1 = test_v01_online1[test_v01_online1.predict > np.percentile(test_v01_online1.predict,92)][['user_id','cate','shop_id']]
    result2 = test_v01_online2[test_v01_online2.predict > np.percentile(test_v01_online2.predict, 98)][['user_id', 'cate', 'shop_id']]
    result = pd.concat([result1,result2]).drop_duplicates()
    result.to_csv("./result/baseline001.csv",index=None)
    print('baseline1 finished')
    # result1 = pd.
    #
    print('baseline2 start')

    sample_v02 = sample[sample.user_id.isin(class3)]
    test_v01_online1 = sample_v02[sample_v02.action_date == '2018-04-15']
    test_v01_online2 = sample_v02[sample_v02.action_date == '2018-04-14']

    model = lgb_model()
    model.train(sample=sample_v02[sample_v02.action_date < '2018-04-13'],features=features)
    test_v01_online1 = model.predict(test_v01_online1,features)
    test_v01_online2 = model.predict(test_v01_online2,features)
    result1 = test_v01_online1[test_v01_online1.predict > np.percentile(test_v01_online1.predict, 92)][
        ['user_id', 'cate', 'shop_id']]
    result2 = test_v01_online2[test_v01_online2.predict > np.percentile(test_v01_online2.predict, 98)][
        ['user_id', 'cate', 'shop_id']]
    result = pd.concat([result1, result2]).drop_duplicates()
    result.to_csv("./result/baseline002.csv", index=None)
    print('baseline2 finished')

    #
    sample_ = pd.concat([sample_v01,sample_v02])
    del sample_v01,sample_v02
    gc.collect()
    test_v01_online1 = sample_[sample_.action_date == '2018-04-15']
    test_v01_online2 = sample_[sample_.action_date == '2018-04-14']

    model = lgb_model()
    model.train(sample=sample_[sample_.action_date < '2018-04-13'], features=features)
    test_v01_online1 = model.predict(test_v01_online1, features)
    test_v01_online2 = model.predict(test_v01_online2, features)
    result1 = test_v01_online1[test_v01_online1.predict > np.percentile(test_v01_online1.predict, 92)][
        ['user_id', 'cate', 'shop_id']]
    result2 = test_v01_online2[test_v01_online2.predict > np.percentile(test_v01_online2.predict, 99)][
        ['user_id', 'cate', 'shop_id']]
    result = pd.concat([result1, result2]).drop_duplicates()
    result.to_csv("./result/baseline003.csv", index=None)
    print('baseline3 finished')

    baseline1 = pd.read_csv("./result/baseline001.csv")
    baseline2 = pd.read_csv("./result/baseline002.csv")
    baseline3 = pd.read_csv("./result/baseline003.csv")
    result = pd.merge(baseline3, pd.concat([baseline1, baseline2]).drop_duplicates(), on=['user_id', 'cate', 'shop_id'],
                      how='inner')
    result.to_csv("./result/result.csv",index=None)
    